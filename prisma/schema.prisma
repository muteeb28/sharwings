generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String
  role      Role     @default(customer)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  cartItems      CartItem[]
  orders         Order[]
  coupons        Coupon[]
  warrantyClaims WarrantyClaim[]

  address Json? 

  @@map("users")
}

model Product {
  id          String   @id @default(uuid())
  name        String
  description String
  price       Float
  salePrice   Float
  image       String
  category    String
  isFeatured  Boolean  @default(false)
  quantity    Int      @default(0)
  closeOut    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  cartItems  CartItem[]
  orderItems OrderItem[]

  @@map("products")
}

model CartItem {
  id        String   @id @default(uuid())
  quantity  Int      @default(1)
  userId    String
  productId String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("cart_items")
}

model Order {
  id                String      @id @default(uuid())
  userId            String
  totalAmount       Float
  razorpayPaymentId String?     @unique
  razorpayOrderId   String?     @unique
  status            OrderStatus @default(pending)
  mode              PaymentMode @default(cod)
  address           Json? // Shipping address
  
  // Return request fields
  returnReason      String?
  returnDescription String?
  isReturnRequested Boolean     @default(false)
  returnStatus      ReturnStatus @default(None)
  returnRequestedAt DateTime?
  returnProcessedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user       User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  orderItems OrderItem[]

  @@map("orders")
}

model OrderItem {
  id        String @id @default(uuid())
  orderId   String
  productId String
  quantity  Int
  price     Float

  order   Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("order_items")
}

model Coupon {
  id                 String   @id @default(uuid())
  code               String   @unique
  discountPercentage Float
  expirationDate     DateTime
  isActive           Boolean  @default(true)
  userId             String
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("coupons")
}

model WarrantyClaim {
  id          String   @id @default(uuid())
  userId      String
  productName String
  reason      String
  address     String
  phone       String
  imageUrl    String
  status      ClaimStatus @default(pending)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("warranty_claims")
}

enum Role {
  customer
  admin
}

enum OrderStatus {
  pending
  processed
  shipped
  delivered
  cancelled
}

enum PaymentMode {
  cod
  online
}

enum ReturnStatus {
  None
  Requested
  Approved
  Rejected
  Completed
}

enum ClaimStatus {
  pending
  approved
  rejected
}
